---
title: Range Sum Query 2D - Immutable
category: Arrays And Hashing
difficulty: Medium
---

<Callout>

[Leetcode Link](https://leetcode.com/problems/range-sum-query-2d-immutable)

</Callout>

## Description
Given a 2D matrix <code>matrix</code>, handle multiple queries of the following type:


	- Calculate the sum of the elements of <code>matrix</code> inside the rectangle defined by its upper left corner <code>(row1, col1)</code> and lower right corner <code>(row2, col2)</code>.


Implement the <code>NumMatrix</code> class:


	- <code>NumMatrix(int[][] matrix)</code> Initializes the object with the integer matrix <code>matrix</code>.
	- <code>int sumRegion(int row1, int col1, int row2, int col2)</code> Returns the sum of the elements of <code>matrix</code> inside the rectangle defined by its upper left corner <code>(row1, col1)</code> and lower right corner <code>(row2, col2)</code>.


You must design an algorithm where <code>sumRegion</code> works on <code>O(1)</code> time complexity.

 
Example 1:
<Image alt="" src="https://assets.leetcode.com/uploads/2021/03/14/sum-grid.jpg" width={415} height={415} />
<br /><pre className="overflow-x-auto">
Input
[&quot;NumMatrix&quot;, &quot;sumRegion&quot;, &quot;sumRegion&quot;, &quot;sumRegion&quot;]
[[[[3, 0, 1, 4, 2], [5, 6, 3, 2, 1], [1, 2, 0, 1, 5], [4, 1, 0, 1, 7], [1, 0, 3, 0, 5]]], [2, 1, 4, 3], [1, 1, 2, 2], [1, 2, 2, 4]]
Output
[null, 8, 11, 12]

Explanation
NumMatrix numMatrix = new NumMatrix([[3, 0, 1, 4, 2], [5, 6, 3, 2, 1], [1, 2, 0, 1, 5], [4, 1, 0, 1, 7], [1, 0, 3, 0, 5]]);
numMatrix.sumRegion(2, 1, 4, 3); // return 8 (i.e sum of the red rectangle)
numMatrix.sumRegion(1, 1, 2, 2); // return 11 (i.e sum of the green rectangle)
numMatrix.sumRegion(1, 2, 2, 4); // return 12 (i.e sum of the blue rectangle)
</pre>

 
Constraints:


	- <code>m == matrix.length</code>
	- <code>n == matrix[i].length</code>
	- <code>1 &lt;= m, n &lt;= 200</code>
	- <code>-10<sup>4</sup> &lt;= matrix[i][j] &lt;= 10<sup>4</sup></code>
	- <code>0 &lt;= row1 &lt;= row2 &lt; m</code>
	- <code>0 &lt;= col1 &lt;= col2 &lt; n</code>
	- At most <code>10<sup>4</sup></code> calls will be made to <code>sumRegion</code>.



## Solution

### Javascript
```javascript
/**
 * https://leetcode.com/problems/range-sum-query-2d-immutable/
 * @class NumMatrix
 * @param {number[][]} matrix
 */
class NumMatrix {
  constructor(matrix) {
    this.matrix = matrix;
  }

  /** 
   * 
   * m = row2 - row1; n = col2 - col1
   * Time O(m*n) | Space O(1)
   * @param {number} row1 
   * @param {number} col1 
   * @param {number} row2 
   * @param {number} col2
   * @return {number}
   */
  sumRegion(row1, col1, row2, col2) {
    let sum = 0;
    for (let i = row1; i < row2 + 1; i++) {
      for (let j = col1; j < col2 + 1; j++) {
        sum += this.matrix[i][j];
      }
    }
    return sum;
  }
}

/** 
 * Your NumMatrix object will be instantiated and called as such:
 * var obj = new NumMatrix(matrix)
 * var param_1 = obj.sumRegion(row1,col1,row2,col2)
 */

```
### Python
```python
class NumMatrix:
    def __init__(self, matrix):
        self.sum_ = [[0] * (len(matrix[0]) + 1) for _ in range(len(matrix) + 1)]
        for i, line in enumerate(matrix):
            previous = 0
            for j, num in enumerate(line):
                previous += num
                above = self.sum_[i][j + 1]
                self.sum_[i + 1][j + 1] = previous + above

    def sumRegion(self, row1, col1, row2, col2):
        sum_col2 = self.sum_[row2 + 1][col2 + 1] - self.sum_[row1][col2 + 1]
        sum_col1 = self.sum_[row2 + 1][col1] - self.sum_[row1][col1]
        return sum_col2 - sum_col1

```
### C++
```cpp
class NumMatrix {
public:

    vector<vector<int>> dp;

    NumMatrix(vector<vector<int>>& matrix) {
        int r = matrix.size(),c = matrix[0].size();
        dp = matrix;

        for(int i =0;i<r;i++){
            for(int j =0;j<c;j++){
                if(i>0) dp[i][j] += dp[i-1][j]; // add prev row
                if(j>0) dp[i][j] += dp[i][j-1]; // add prev col

                // remove diagonal as it is added twice above
                if(i>0&&j>0) dp[i][j] -= dp[i-1][j-1];
            }
        }
    }
    
    int sumRegion(int row1, int col1, int row2, int col2) {
        int answer = dp[row2][col2];

        if(row1>0) answer -= dp[row1-1][col2];  // remove prev row on col1
        if(col1>0) answer -= dp[row2][col1-1]; // remo prev col on row2

        // add prev diagonal as pre row and prev col both contains that value
        if(row1>0&&col1>0) answer += dp[row1-1][col1-1];
        return answer;
    }
};

/**
 * Your NumMatrix object will be instantiated and called as such:
 * NumMatrix* obj = new NumMatrix(matrix);
 * int param_1 = obj->sumRegion(row1,col1,row2,col2);
 */
```
### Java
```java
404: Not Found
```


